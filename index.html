<!DOCTYPE html>
<html lang="pl">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>ðŸ¦Ž Terrarium Pro Control</title>
Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
Â  Â  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
Â  Â  <link rel="stylesheet" href="style.css">
Â  Â  <style>
Â  Â  Â  Â  /* Dodatkowe style dla nowych funkcji */
Â  Â  Â  Â  .recent-colors { display: flex; gap: 10px; margin-top: 10px; }
Â  Â  Â  Â  .color-circle { width: 30px; height: 30px; border-radius: 50%; border: 2px solid #444; cursor: pointer; }
Â  Â  Â  Â  .effects-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
Â  Â  Â  Â  .effect-btn { padding: 10px; border: none; border-radius: 8px; background: #333; color: white; cursor: pointer; transition: 0.3s; }
Â  Â  Â  Â  .effect-btn:hover { background: #555; }
Â  Â  Â  Â  .effect-btn.active { background: #ff9800; color: black; font-weight: bold; }
Â  Â  </style>
</head>
<body>
Â  Â  <div id="login-form" class="login-overlay">
Â  Â  Â  Â  <div class="card login-card">
Â  Â  Â  Â  Â  Â  <h2><i class="fas fa-lock"></i> Autoryzacja</h2>
Â  Â  Â  Â  Â  Â  <input type="email" id="login-email" placeholder="Email" class="input-field">
Â  Â  Â  Â  Â  Â  <input type="password" id="login-password" placeholder="HasÅ‚o" class="input-field">
Â  Â  Â  Â  Â  Â  <button id="login-btn" class="action-btn">Zaloguj</button>
Â  Â  Â  Â  Â  Â  <p id="auth-error" class="error-msg" style="display: none;"></p>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="container" id="app-container" style="display: none;">
Â  Â  Â  Â  <header>
Â  Â  Â  Â  Â  Â  <h1>ðŸ¦Ž Inteligentne Terrarium IoT</h1>
Â  Â  Â  Â  Â  Â  <div id="notification-bar" class="notification"></div>
Â  Â  Â  Â  </header>
Â  Â  Â  Â  
Â  Â  Â  Â  <section class="card control-section">
Â  Â  Â  Â  Â  Â  <h2><i class="fas fa-sliders-h"></i> Sterowanie Manualne</h2>
Â  Â  Â  Â  Â  Â  <button id="auto-toggle-btn" class="action-btn auto-toggle">PrzeÅ‚Ä…cz na AUTO</button>
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <div class="button-grid">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="heater-toggle-btn" class="device-btn"><i class="fas fa-fire"></i> Grzanie</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="mist-toggle-btn" class="device-btn"><i class="fas fa-cloud-showers-heavy"></i> MgieÅ‚ka</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="fan-toggle-btn" class="device-btn"><i class="fas fa-wind"></i> Nawiew</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="led-toggle-btn" class="device-btn"><i class="fas fa-lightbulb"></i> ÅšwiatÅ‚o</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <div class="led-advanced">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>OÅ›wietlenie Pro</h3>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <div class="led-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span>Kolor:</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <input type="color" id="color-picker" value="#FFFFFF" onchange="handleColorChange(this.value)">
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="led-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Ostatnie:</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="recent-colors-container" class="recent-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <h3>Efekty i Atmosfera</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="effects-grid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="effect-btn" onclick="setLedMode('static')">StaÅ‚y Kolor</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="effect-btn" onclick="setLedMode('fire')">ðŸ”¥ Ognisko</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="effect-btn" onclick="setLedMode('storm')">âš¡ Burza</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="effect-btn" onclick="setLedMode('sunrise')">ðŸŒ… WschÃ³d</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="led-row" style="margin-top:20px">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>JasnoÅ›Ä‡:</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="range" id="brightness-slider" min="0" max="255" value="255">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </section>

Â  Â  Â  Â  </div>

Â  Â  <script type="module">
Â  Â  Â  Â  // --- LOGIKA JS DLA NOWYCH FUNKCJI ---
Â  Â  Â  Â  
Â  Â  Â  Â  // Zapisywanie 3 ostatnich kolorÃ³w w LocalStorage
Â  Â  Â  Â  function saveRecentColor(hex) {
Â  Â  Â  Â  Â  Â  let colors = JSON.parse(localStorage.getItem('recentColors') || '[]');
Â  Â  Â  Â  Â  Â  if (!colors.includes(hex)) {
Â  Â  Â  Â  Â  Â  Â  Â  colors.unshift(hex);
Â  Â  Â  Â  Â  Â  Â  Â  if (colors.length > 3) colors.pop();
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('recentColors', JSON.stringify(colors));
Â  Â  Â  Â  Â  Â  Â  Â  renderRecentColors();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderRecentColors() {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('recent-colors-container');
Â  Â  Â  Â  Â  Â  const colors = JSON.parse(localStorage.getItem('recentColors') || '[]');
Â  Â  Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  Â  Â  colors.forEach(hex => {
Â  Â  Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  div.className = 'color-circle';
Â  Â  Â  Â  Â  Â  Â  Â  div.style.backgroundColor = hex;
Â  Â  Â  Â  Â  Â  Â  Â  div.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('color-picker').value = hex;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handleColorChange(hex);
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(div);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  // Funkcja wysyÅ‚ajÄ…ca kolor do NodeMCU
Â  Â  Â  Â  window.handleColorChange = function(hex) {
Â  Â  Â  Â  Â  Â  const r = parseInt(hex.substring(1, 3), 16);
Â  Â  Â  Â  Â  Â  const g = parseInt(hex.substring(3, 5), 16);
Â  Â  Â  Â  Â  Â  const b = parseInt(hex.substring(5, 7), 16);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  saveRecentColor(hex);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // WysyÅ‚ka do lokalnego serwera NodeMCU
Â  Â  Â  Â  Â  Â  fetch(`/setColor?r=${r}&g=${g}&b=${b}`)
Â  Â  Â  Â  Â  Â  Â  Â  .then(() => console.log("Kolor wysÅ‚any: ", hex))
Â  Â  Â  Â  Â  Â  Â  Â  .catch(err => console.error("BÅ‚Ä…d poÅ‚Ä…czenia z NodeMCU"));
Â  Â  Â  Â  }

Â  Â  Â  Â  // Funkcja zmieniajÄ…ca tryb (mode)
Â  Â  Â  Â  window.setLedMode = function(mode) {
Â  Â  Â  Â  Â  Â  fetch(`/setMode?m=${mode}`)
Â  Â  Â  Â  Â  Â  Â  Â  .then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Wizualne zaznaczenie aktywnego przycisku
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.effect-btn').forEach(btn => btn.classList.remove('active'));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  event.target.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  // Inicjalizacja przy starcie
Â  Â  Â  Â  window.onload = () => {
Â  Â  Â  Â  Â  Â  renderRecentColors();
Â  Â  Â  Â  };
Â  Â  </script>
</body>
</html>